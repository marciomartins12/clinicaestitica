
<header>
    <style>
        /* Estilos específicos para a página Minha Clínica */
        .clinic-tabs {
            margin-bottom: 30px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0;
        }

        .tab-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: white;
            border: 1px solid #e5e7eb;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #6b7280;
            font-weight: 500;
        }

        .tab-btn:hover {
            background: #f9fafb;
            color: #374151;
        }

        .tab-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
            transform: translateY(2px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Configurações */
        .config-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }

        .config-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .config-header h3 {
            margin: 0 0 8px 0;
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-header p {
            margin: 0;
            color: #6b7280;
            font-size: 14px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h4 {
            margin: 0 0 20px 0;
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            padding-bottom: 10px;
            border-bottom: 1px solid #f3f4f6;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 6px;
        }

        .form-input,
        .form-select {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 1px #2563eb;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        /* Profissionais e Recepcionistas */
        .professionals-container,
        .receptionists-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }

        .professionals-header,
        .receptionists-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .professionals-header h3,
        .receptionists-header h3 {
            margin: 0 0 8px 0;
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .professionals-header p,
        .receptionists-header p {
            margin: 0;
            color: #6b7280;
            font-size: 14px;
        }

        .user-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .user-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .user-card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: #2563eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .user-info {
            flex: 1;
        }

        .user-info h4 {
            margin: 0 0 4px 0;
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }

        .user-type {
            font-size: 12px;
            color: #6b7280;
            background: #e5e7eb;
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 500;
        }

        .user-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 6px;
            background: #f3f4f6;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: #2563eb;
            color: white;
        }

        .btn-icon.delete:hover {
            background: #ef4444;
            color: white;
        }

        .user-details {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #6b7280;
        }

        .detail-item i {
            width: 16px;
            color: #9ca3af;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 18px;
            color: #6b7280;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 20px 25px;
            border-top: 1px solid #e5e7eb;
            background: #f9fafb;
            border-radius: 0 0 12px 12px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        /* Estado Vazio */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            color: #d1d5db;
        }

        .empty-state h4 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #374151;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .tab-buttons {
                flex-wrap: wrap;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .professionals-header,
            .receptionists-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .user-details {
                flex-direction: column;
                gap: 10px;
            }
            
            .modal-content {
                margin: 10px;
                max-height: 95vh;
            }
            
            .modal-header,
            .modal-body,
            .modal-footer {
                padding: 15px 20px;
            }
        }
    </style>
</header>

<!-- Mobile Menu Button -->
<button class="mobile-menu-btn" onclick="toggleMobileMenu()">
    <i class="fas fa-bars"></i>
</button>

<!-- Sidebar Overlay -->
<div class="sidebar-overlay" onclick="closeMobileMenu()"></div>

<div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <h2><i class="fas fa-spa"></i> {{clinica.nome}}</h2>
        </div>

        <ul class="nav-menu">
            <li class="nav-item"><a href="/sistema/dashboard" class="nav-link"><i class="fas fa-home"></i>Inicio</a></li>
            <li class="nav-item"><a href="/sistema/agenda" class="nav-link"><i class="fas fa-calendar-alt"></i>Agenda</a></li>
            <li class="nav-item"><a href="/sistema/pacientes" class="nav-link"><i class="fas fa-users"></i>Pacientes</a></li>
            <li class="nav-item"><a href="/sistema/atendimento" class="nav-link"><i class="fas fa-user-md"></i>Atendimentos</a></li>
            <li class="nav-item"><a href="/sistema/financeiro" class="nav-link"><i class="fas fa-dollar-sign"></i>Financeiro</a></li>
            <li class="nav-item"><a href="/sistema/produtos" class="nav-link"><i class="fas fa-box"></i>Produtos</a></li>
            <li class="nav-item"><a href="/sistema/minha-clinica" class="nav-link active"><i class="fas fa-clinic-medical"></i>Minha Clínica</a></li>
        </ul>

        <!-- User Section -->
        <div class="sidebar-user">
            <div class="user-profile">
                <div><i class="fa-solid fa-user"></i></div>
                <div class="user-details">
                    <div class="user-name-sidebar">{{user.nome}}</div>
                    <div class="user-role">{{user.tipo_usuario}}</div>
                </div>
            </div>
            <a href="/login" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                Sair
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="welcome-text">
                <h1><i class="fas fa-clinic-medical"></i> Minha Clínica</h1>
                <p>Gerencie as configurações da sua clínica</p>
            </div>
        </div>

        <!-- Abas de Navegação -->
        <div class="clinic-tabs">
            <div class="tab-buttons">
                <div class="tab-btn active" onclick="switchTab('configuracoes')">
                    <i class="fas fa-cog"></i>
                    Configurações
                </div>
                <div class="tab-btn" onclick="switchTab('profissionais')">
                    <i class="fas fa-user-md"></i>
                    Profissionais
                </div>
                <div class="tab-btn" onclick="switchTab('recepcionistas')">
                     <i class="fas fa-user-tie"></i>
                     Atendentes
                 </div>
            </div>
        </div>

        <!-- Conteúdo das Abas -->
        
        <!-- Configurações da Clínica -->
        <div id="configuracoes" class="tab-content active">
            <div class="config-container">
                <div class="config-header">
                    <h3><i class="fas fa-cog"></i> Configurações da Clínica</h3>
                    <p>Gerencie as informações básicas da sua clínica</p>
                </div>
                
                <form id="clinicForm" class="config-form">
                    <div class="form-section">
                        <h4>Informações Básicas</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nome da Clínica *</label>
                                <input type="text" name="nome" class="form-input" value="{{clinica.nome}}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">CNPJ</label>
                                <input type="text" name="cnpj" class="form-input" value="{{clinica.cnpj}}" placeholder="00.000.000/0000-00">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Telefone *</label>
                                <input type="tel" name="telefone" class="form-input" value="{{clinica.telefone}}" placeholder="(00) 00000-0000" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" name="email" class="form-input" value="{{clinica.email}}" placeholder="contato@clinica.com">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Endereço</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Endereço Completo</label>
                                <textarea name="endereco" class="form-input" rows="3" placeholder="Rua, número, bairro, cidade, estado">{{clinica.endereco}}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Informações Adicionais</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Horário de Funcionamento</label>
                                <textarea name="horario_funcionamento" class="form-input" rows="2" placeholder="Ex: Segunda a Sexta: 8h às 18h">{{clinica.horario_funcionamento}}</textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Especialidades</label>
                                <textarea name="especialidades" class="form-input" rows="2" placeholder="Ex: Dermatologia, Estética, Fisioterapia">{{clinica.especialidades}}</textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Responsável Técnico</label>
                                <input type="text" name="responsavel_tecnico" class="form-input" value="{{clinica.responsavel_tecnico}}" placeholder="Nome do responsável">
                            </div>
                            <div class="form-group">
                                <label class="form-label">CRM do Responsável</label>
                                <input type="text" name="crm_responsavel" class="form-input" value="{{clinica.crm_responsavel}}" placeholder="CRM 12345">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Site</label>
                                <input type="url" name="site" class="form-input" value="{{clinica.site}}" placeholder="https://www.clinica.com">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Observações</label>
                            <textarea name="observacoes" class="form-input" rows="3" placeholder="Informações adicionais sobre a clínica">{{clinica.observacoes}}</textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Salvar Configurações
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Profissionais -->
        <div id="profissionais" class="tab-content">
            <div class="professionals-container">
                <div class="professionals-header">
                    <div>
                        <h3><i class="fas fa-user-md"></i> Profissionais</h3>
                        <p>Gerencie os profissionais da sua clínica</p>
                    </div>
                    <button class="btn btn-primary" onclick="showCreateProfessionalModal()">
                        <i class="fas fa-plus"></i>
                        Novo Profissional
                    </button>
                </div>
                
                <div id="professionalsContainer">
                    <!-- Profissionais serão carregados via JavaScript -->
                </div>
            </div>
        </div>

        <!-- Recepcionistas -->
        <div id="recepcionistas" class="tab-content">
            <div class="receptionists-container">
                <div class="receptionists-header">
                     <div>
                         <h3><i class="fas fa-user-tie"></i> Atendentes</h3>
                         <p>Gerencie os atendentes da sua clínica</p>
                     </div>
                     <button class="btn btn-primary" onclick="showCreateReceptionistModal()">
                         <i class="fas fa-plus"></i>
                         Novo Atendente
                     </button>
                 </div>
                
                <div id="receptionistsContainer">
                    <!-- Recepcionistas serão carregados via JavaScript -->
                </div>
            </div>
        </div>

        <!-- Estado Vazio -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <i class="fas fa-users"></i>
            <h4>Nenhum usuário encontrado</h4>
            <p>Adicione profissionais e atendentes à sua clínica</p>
        </div>
    </div>
</div>

<script src="/js/shared.js"></script>
<script src="/js/menuMobile.js"></script>
<script>
    let currentTab = 'configuracoes';
    let professionals = [];
    let receptionists = [];

    // Inicializar página
    document.addEventListener('DOMContentLoaded', function() {
        loadUsers();
    });

    // Trocar aba
    function switchTab(tabName) {
        // Atualizar botões
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.closest('.tab-btn').classList.add('active');
        
        // Atualizar conteúdo
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        
        currentTab = tabName;
        
        if (tabName === 'profissionais') {
            renderProfessionals();
        } else if (tabName === 'recepcionistas') {
            renderReceptionists();
        }
    }

    // Carregar usuários
    async function loadUsers() {
        try {
            const response = await fetch('/sistema/usuarios/api');
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    professionals = data.data.filter(user => user.tipo_usuario === 'profissional');
                    receptionists = data.data.filter(user => user.tipo_usuario === 'atendente');
                    
                    if (currentTab === 'profissionais') {
                        renderProfessionals();
                    } else if (currentTab === 'recepcionistas') {
                        renderReceptionists();
                    }
                }
            }
        } catch (error) {
            console.error('Erro ao carregar usuários:', error);
            Notification.error('Erro ao carregar usuários');
        }
    }

    // Renderizar profissionais
    function renderProfessionals() {
        const container = document.getElementById('professionalsContainer');
        const emptyState = document.getElementById('emptyState');
        
        if (professionals.length === 0) {
            container.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        container.innerHTML = professionals.map(professional => `
             <div class="user-card">
                 <div class="user-card-header">
                     <div class="user-avatar">
                         <i class="fas fa-user-md"></i>
                     </div>
                     <div class="user-info">
                         <h4>${professional.nome}</h4>
                         <span class="user-type">${professional.especialidade || 'Profissional'}</span>
                     </div>
                     <div class="user-actions">
                         <button class="btn-icon" onclick="editUser(${professional.id})" title="Editar">
                             <i class="fas fa-edit"></i>
                         </button>
                         <button class="btn-icon delete" onclick="deleteUser(${professional.id})" title="Excluir">
                             <i class="fas fa-trash"></i>
                         </button>
                     </div>
                 </div>
                 <div class="user-details">
                     <div class="detail-item">
                         <i class="fas fa-envelope"></i>
                         <span>${professional.email}</span>
                     </div>
                     <div class="detail-item">
                         <i class="fas fa-phone"></i>
                         <span>${professional.telefone || 'Não informado'}</span>
                     </div>
                     <div class="detail-item">
                         <i class="fas fa-id-card"></i>
                         <span>${professional.cpf || 'Não informado'}</span>
                     </div>
                     ${professional.registro ? `
                         <div class="detail-item">
                             <i class="fas fa-certificate"></i>
                             <span>${professional.registro}</span>
                         </div>
                     ` : ''}
                     ${professional.setor ? `
                         <div class="detail-item">
                             <i class="fas fa-building"></i>
                             <span>${professional.setor}</span>
                         </div>
                     ` : ''}
                     ${professional.horario_trabalho ? `
                         <div class="detail-item">
                             <i class="fas fa-clock"></i>
                             <span>${professional.horario_trabalho}</span>
                         </div>
                     ` : ''}
                 </div>
             </div>
         `).join('');
    }

    // Renderizar recepcionistas
    function renderReceptionists() {
        const container = document.getElementById('receptionistsContainer');
        const emptyState = document.getElementById('emptyState');
        
        if (receptionists.length === 0) {
            container.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        container.innerHTML = receptionists.map(receptionist => `
             <div class="user-card">
                 <div class="user-card-header">
                     <div class="user-avatar">
                         <i class="fas fa-user-tie"></i>
                     </div>
                     <div class="user-info">
                         <h4>${receptionist.nome}</h4>
                         <span class="user-type">Atendente</span>
                     </div>
                     <div class="user-actions">
                         <button class="btn-icon" onclick="editUser(${receptionist.id})" title="Editar">
                             <i class="fas fa-edit"></i>
                         </button>
                         <button class="btn-icon delete" onclick="deleteUser(${receptionist.id})" title="Excluir">
                             <i class="fas fa-trash"></i>
                         </button>
                     </div>
                 </div>
                 <div class="user-details">
                     <div class="detail-item">
                         <i class="fas fa-envelope"></i>
                         <span>${receptionist.email}</span>
                     </div>
                     <div class="detail-item">
                         <i class="fas fa-phone"></i>
                         <span>${receptionist.telefone || 'Não informado'}</span>
                     </div>
                     <div class="detail-item">
                         <i class="fas fa-id-card"></i>
                         <span>${receptionist.cpf || 'Não informado'}</span>
                     </div>
                     ${receptionist.horario_trabalho ? `
                         <div class="detail-item">
                             <i class="fas fa-clock"></i>
                             <span>${receptionist.horario_trabalho}</span>
                         </div>
                     ` : ''}
                 </div>
             </div>
         `).join('');
    }

    // Mostrar modal de criar profissional
    function showCreateProfessionalModal() {
        showCreateUserModal('profissional');
    }

    // Mostrar modal de criar atendente
     function showCreateReceptionistModal() {
         showCreateUserModal('atendente');
     }

    // Mostrar modal de criar usuário
     function showCreateUserModal(type) {
         const title = type === 'profissional' ? 'Novo Profissional' : 'Novo Atendente';
         const icon = type === 'profissional' ? 'fa-user-md' : 'fa-user-tie';
         
         let formFields = '';
         
         if (type === 'profissional') {
             formFields = `
                 <div class="form-row">
                     <div class="form-group">
                         <label class="form-label">Nome Completo *</label>
                         <input type="text" name="nome" class="form-input" required>
                     </div>
                     <div class="form-group">
                         <label class="form-label">Email *</label>
                         <input type="email" name="email" class="form-input" required>
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-group">
                         <label class="form-label">CPF *</label>
                         <input type="text" name="cpf" class="form-input" placeholder="000.000.000-00" required>
                     </div>
                     <div class="form-group">
                         <label class="form-label">RG</label>
                         <input type="text" name="rg" class="form-input" placeholder="00.000.000-0">
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-group">
                         <label class="form-label">Telefone</label>
                         <input type="tel" name="telefone" class="form-input" placeholder="(00) 00000-0000">
                     </div>
                     <div class="form-group">
                         <label class="form-label">Data de Nascimento</label>
                         <input type="date" name="data_nascimento" class="form-input">
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-group">
                         <label class="form-label">Especialidade *</label>
                         <input type="text" name="especialidade" class="form-input" placeholder="Ex: Dermatologia, Fisioterapia" required>
                     </div>
                     <div class="form-group">
                         <label class="form-label">Registro Profissional</label>
                         <input type="text" name="registro" class="form-input" placeholder="Ex: CRM 12345, CREFITO 54321">
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-group">
                         <label class="form-label">Data de Admissão</label>
                         <input type="date" name="data_admissao" class="form-input">
                     </div>
                     <div class="form-group">
                         <label class="form-label">Salário</label>
                         <input type="number" name="salario" class="form-input" step="0.01" min="0" placeholder="0.00">
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-group">
                         <label class="form-label">Horário de Trabalho</label>
                         <input type="text" name="horario_trabalho" class="form-input" placeholder="Ex: Segunda a Sexta: 8h às 17h">
                     </div>
                     <div class="form-group">
                         <label class="form-label">Setor</label>
                         <input type="text" name="setor" class="form-input" placeholder="Ex: Estética, Fisioterapia">
                     </div>
                 </div>
                 <div class="form-group">
                     <label class="form-label">Endereço</label>
                     <textarea name="endereco" class="form-input" rows="2" placeholder="Endereço completo"></textarea>
                 </div>
                 <div class="form-group">
                     <label class="form-label">Formação</label>
                     <textarea name="formacao" class="form-input" rows="2" placeholder="Graduação, pós-graduação, cursos..."></textarea>
                 </div>
                 <div class="form-group">
                     <label class="form-label">Certificações</label>
                     <textarea name="certificacoes" class="form-input" rows="2" placeholder="Certificados, especializações..."></textarea>
                 </div>
                 <div class="form-group">
                     <label class="form-label">Experiência</label>
                     <textarea name="experiencia" class="form-input" rows="2" placeholder="Experiência profissional anterior..."></textarea>
                 </div>
                 <div class="form-group">
                     <label class="form-label">Habilidades</label>
                     <textarea name="habilidades" class="form-input" rows="2" placeholder="Habilidades técnicas e interpessoais..."></textarea>
                 </div>
             `;
         } else {
              // Formulário simplificado para atendentes
              formFields = `
                 <div class="form-row">
                     <div class="form-group">
                         <label class="form-label">Nome Completo *</label>
                         <input type="text" name="nome" class="form-input" required>
                     </div>
                     <div class="form-group">
                         <label class="form-label">Email *</label>
                         <input type="email" name="email" class="form-input" required>
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-group">
                         <label class="form-label">CPF *</label>
                         <input type="text" name="cpf" class="form-input" placeholder="000.000.000-00" required>
                     </div>
                     <div class="form-group">
                         <label class="form-label">RG</label>
                         <input type="text" name="rg" class="form-input" placeholder="00.000.000-0">
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-group">
                         <label class="form-label">Telefone</label>
                         <input type="tel" name="telefone" class="form-input" placeholder="(00) 00000-0000">
                     </div>
                     <div class="form-group">
                         <label class="form-label">Data de Nascimento</label>
                         <input type="date" name="data_nascimento" class="form-input">
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-group">
                         <label class="form-label">Data de Admissão</label>
                         <input type="date" name="data_admissao" class="form-input">
                     </div>
                     <div class="form-group">
                         <label class="form-label">Salário</label>
                         <input type="number" name="salario" class="form-input" step="0.01" min="0" placeholder="0.00">
                     </div>
                 </div>
                 <div class="form-group">
                     <label class="form-label">Horário de Trabalho</label>
                     <input type="text" name="horario_trabalho" class="form-input" placeholder="Ex: Segunda a Sexta: 8h às 17h">
                 </div>
                 <div class="form-group">
                     <label class="form-label">Endereço</label>
                     <textarea name="endereco" class="form-input" rows="2" placeholder="Endereço completo"></textarea>
                 </div>
             `;
         }
         
         const modalHtml = `
             <div id="createUserModal" class="modal-overlay" onclick="closeCreateUserModal(event)">
                 <div class="modal-content" onclick="event.stopPropagation()">
                     <div class="modal-header">
                         <h3><i class="fas ${icon}"></i> ${title}</h3>
                         <button class="modal-close" onclick="closeCreateUserModal()">
                             <i class="fas fa-times"></i>
                         </button>
                     </div>
                     <form id="createUserForm" onsubmit="submitCreateUser(event, '${type}')">
                         <div class="modal-body">
                             ${formFields}
                             <div class="form-row">
                                 <div class="form-group">
                                     <label class="form-label">Senha *</label>
                                     <input type="password" name="senha" class="form-input" required>
                                 </div>
                                 <div class="form-group">
                                     <label class="form-label">Confirmar Senha *</label>
                                     <input type="password" name="confirmarSenha" class="form-input" required>
                                 </div>
                             </div>
                         </div>
                         <div class="modal-footer">
                             <button type="button" class="btn btn-secondary" onclick="closeCreateUserModal()">
                                 Cancelar
                             </button>
                             <button type="submit" class="btn btn-primary">
                                 <i class="fas fa-save"></i> Salvar ${type === 'profissional' ? 'Profissional' : 'Atendente'}
                             </button>
                         </div>
                     </form>
                 </div>
             </div>
         `;
         
         document.body.insertAdjacentHTML('beforeend', modalHtml);
     }

    // Fechar modal de criar usuário
    function closeCreateUserModal(event) {
        if (event && event.target !== event.currentTarget) return;
        
        const modal = document.getElementById('createUserModal');
        if (modal) {
            modal.remove();
        }
    }

    // Submeter formulário de criar usuário
    async function submitCreateUser(event, type) {
        event.preventDefault();
        
        const form = event.target;
        const formData = new FormData(form);
        
        // Validar senhas
        const senha = formData.get('senha');
        const confirmarSenha = formData.get('confirmarSenha');
        
        if (senha !== confirmarSenha) {
            Notification.error('As senhas não coincidem');
            return;
        }
        
        const userData = {
             nome: formData.get('nome'),
             email: formData.get('email'),
             cpf: formData.get('cpf') || null,
             rg: formData.get('rg') || null,
             telefone: formData.get('telefone') || null,
             data_nascimento: formData.get('data_nascimento') || null,
             endereco: formData.get('endereco') || null,
             senha: senha,
             tipo_usuario: type,
             data_admissao: formData.get('data_admissao') || null,
             salario: formData.get('salario') ? parseFloat(formData.get('salario')) : null,
             horario_trabalho: formData.get('horario_trabalho') || null,
             especialidade: formData.get('especialidade') || null,
             registro: formData.get('registro') || null,
             formacao: formData.get('formacao') || null,
             certificacoes: formData.get('certificacoes') || null,
             experiencia: formData.get('experiencia') || null,
             setor: formData.get('setor') || null,
             habilidades: formData.get('habilidades') || null
         };
        
        try {
            const response = await fetch('/sistema/usuarios/api', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            });
            
            const result = await response.json();
            
            if (result.success) {
                Notification.success(`${type === 'profissional' ? 'Profissional' : 'Atendente'} criado com sucesso!`);
                closeCreateUserModal();
                loadUsers(); // Recarregar usuários
            } else {
                Notification.error(result.message || `Erro ao criar ${type}`);
            }
            
        } catch (error) {
            console.error(`Erro ao criar ${type}:`, error);
            Notification.error(`Erro ao criar ${type}`);
        }
    }

    // Editar usuário
    function editUser(id) {
        Notification.info('Funcionalidade de edição em desenvolvimento');
    }

    // Excluir usuário
    async function deleteUser(id) {
        const user = [...professionals, ...receptionists].find(u => u.id === id);
        if (!user) {
            Notification.error('Usuário não encontrado');
            return;
        }
        
        if (!confirm(`Tem certeza que deseja excluir "${user.nome}"?\n\nEsta ação não pode ser desfeita.`)) {
            return;
        }
        
        try {
            const response = await fetch(`/sistema/usuarios/api/${id}`, {
                method: 'DELETE'
            });
            
            const result = await response.json();
            
            if (result.success) {
                Notification.success('Usuário excluído com sucesso!');
                loadUsers(); // Recarregar usuários
            } else {
                Notification.error(result.message || 'Erro ao excluir usuário');
            }
            
        } catch (error) {
            console.error('Erro ao excluir usuário:', error);
            Notification.error('Erro ao excluir usuário');
        }
    }

    // Salvar configurações da clínica
    document.getElementById('clinicForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        
        const formData = new FormData(event.target);
        const clinicData = {
            nome: formData.get('nome'),
            cnpj: formData.get('cnpj'),
            telefone: formData.get('telefone'),
            email: formData.get('email'),
            endereco: formData.get('endereco'),
            horario_funcionamento: formData.get('horario_funcionamento'),
            especialidades: formData.get('especialidades'),
            responsavel_tecnico: formData.get('responsavel_tecnico'),
            crm_responsavel: formData.get('crm_responsavel'),
            site: formData.get('site'),
            observacoes: formData.get('observacoes')
        };
        
        try {
            const response = await fetch('/sistema/clinica/api', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(clinicData)
            });
            
            const result = await response.json();
            
            if (result.success) {
                Notification.success('Configurações salvas com sucesso!');
            } else {
                Notification.error(result.message || 'Erro ao salvar configurações');
            }
            
        } catch (error) {
            console.error('Erro ao salvar configurações:', error);
            Notification.error('Erro ao salvar configurações');
        }
    });
</script>
