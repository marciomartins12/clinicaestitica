

<link rel="stylesheet" href="/css/agenda.css">

<!-- Mobile Menu Button -->
<button class="mobile-menu-btn" onclick="toggleMobileMenu()">
    <i class="fas fa-bars"></i>
</button>

<!-- Sidebar Overlay -->
<div class="sidebar-overlay" onclick="closeMobileMenu()"></div>

<div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <h2><i class="fas fa-spa"></i> Bella Estética</h2>
        </div>

        <ul class="nav-menu">
            <li class="nav-item"><a href="/sistema/dashboard" class="nav-link"><i class="fas fa-home"></i>Inicio</a></li>
            <li class="nav-item"><a href="/sistema/agenda" class="nav-link active"><i class="fas fa-calendar-alt"></i>Agenda</a></li>
            <li class="nav-item"><a href="/sistema/pacientes" class="nav-link"><i class="fas fa-users"></i>Pacientes</a></li>
            <li class="nav-item"><a href="/sistema/atendimento" class="nav-link"><i class="fas fa-user-md"></i>Atendimentos</a></li>
            <li class="nav-item"><a href="/sistema/financeiro" class="nav-link"><i class="fas fa-dollar-sign"></i>Financeiro</a></li>
            <li class="nav-item"><a href="/sistema/produtos" class="nav-link"><i class="fas fa-box"></i>Produtos</a></li>
            <li class="nav-item"><a href="/sistema/minhaClinica" class="nav-link"><i class="fas fa-clinic-medical"></i>Minha Clínica</a></li>
        </ul>

        <!-- User Section -->
        <div class="sidebar-user">
            <div class="user-profile">
                <div><i class="fa-solid fa-user"></i></div>
                <div class="user-details">
                    <div class="user-name-sidebar">{{user.nome}}</div>
                    <div class="user-role">{{user.tipo_usuario}}</div>
                </div>
            </div>
            <a href="/sistema/logout" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                Sair
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content agenda-container">
        <!-- Header -->
        <div class="agenda-header">
            <h1 class="agenda-title">
                <i class="fas fa-calendar-alt"></i>
                Agenda de Atendimentos
            </h1>
            <button class="btn btn-primary" onclick="abrirModalAgendamento()">
                <i class="fas fa-plus"></i>
                Novo Agendamento
            </button>
        </div>

        <!-- Filtros -->
        <div class="filters-section">
            <div class="filters-row">
                <div class="form-group">
                    <label class="form-label">Buscar por Nome ou CPF</label>
                    <input type="text" id="buscaInput" class="form-input" placeholder="Digite o nome ou CPF do paciente...">
                </div>
                <div class="form-group">
                    <label class="form-label">Mês</label>
                    <select id="mesSelect" class="form-select">
                        <option value="">Todos</option>
                        <option value="1">Janeiro</option>
                        <option value="2">Fevereiro</option>
                        <option value="3">Março</option>
                        <option value="4">Abril</option>
                        <option value="5">Maio</option>
                        <option value="6">Junho</option>
                        <option value="7">Julho</option>
                        <option value="8">Agosto</option>
                        <option value="9">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>
                </div>
                <div class="form-group">
                     <label class="form-label">Ano</label>
                     <select id="anoSelect" class="form-select">
                         <option value="">Todos</option>
                         <option value="2024">2024</option>
                         <option value="2025">2025</option>
                         <option value="2026">2026</option>
                     </select>
                 </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="buscarAgendamentos()">
                        <i class="fas fa-search"></i>
                        Buscar
                    </button>
                </div>
                <div class="form-group">
                    <button class="btn btn-secondary" onclick="limparFiltros()">
                        <i class="fas fa-refresh"></i>
                        Limpar
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabela de Agendamentos -->
        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">
                    <i class="fas fa-list"></i>
                    Lista de Agendamentos
                </h3>
                <span id="totalRegistros" class="text-muted">Total: 0 agendamentos</span>
            </div>

            <div id="loadingContainer" class="loading" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Carregando agendamentos...</p>
            </div>

            <div id="emptyContainer" class="empty-state" style="display: none;">
                <i class="fas fa-calendar-times"></i>
                <h3>Nenhum agendamento encontrado</h3>
                <p>Não há agendamentos para os filtros selecionados.</p>
            </div>

            <div id="tableContainer" style="display: none;">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Paciente</th>
                            <th>CPF</th>
                            <th>Profissional</th>
                            <th>Procedimento</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>Pagamento</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="agendamentosTableBody">
                        <!-- Dados carregados via JavaScript -->
                    </tbody>
                </table>
            </div>

            <div id="paginationContainer" class="pagination" style="display: none;">
                <!-- Paginação carregada via JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Modal Agendamento -->
<div id="modalAgendamento" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
    <div style="background: white; border-radius: 8px; width: 90%; max-width: 700px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
        <div style="flex: 1; overflow-y: auto; padding: 0;">
        <div style="padding: 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
            <h3 id="modalTitle" style="margin: 0; font-size: 18px; font-weight: 600; color: #1e293b;">Novo Agendamento</h3>
            <button onclick="fecharModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">&times;</button>
        </div>

        <form id="formAgendamento" onsubmit="salvarAgendamento(event)">
            <div style="padding: 20px;">
                <!-- Busca de Paciente -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 5px; font-size: 14px;">Buscar Paciente</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="buscaPaciente" placeholder="Digite nome ou CPF..." style="flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                        <button type="button" onclick="buscarPacientes()" style="padding: 10px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <!-- Info do Paciente -->
                <div id="infoPacienteDiv" style="display: none; margin-bottom: 15px; padding: 12px; background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 6px; color: #1e40af;">
                    <div id="infoPaciente"></div>
                    <input type="hidden" id="pacienteId">
                </div>

                <!-- Profissional -->
                 <div style="margin-bottom: 15px;">
                     <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 5px; font-size: 14px;">Profissional *</label>
                     <select id="profissionalSelect" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                         <option value="">Selecione um profissional</option>
                     </select>
                 </div>

                 <!-- Tipo de Agendamento -->
                 <div style="margin-bottom: 15px;">
                     <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 5px; font-size: 14px;">Tipo de Agendamento</label>
                     <select id="tipoAgendamento" onchange="alterarTipoAgendamento()" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                         <option value="analise">Apenas Análise/Consulta</option>
                         <option value="procedimentos">Com Procedimentos/Produtos</option>
                     </select>
                 </div>

                 <!-- Seção de Itens (Procedimentos e Produtos) -->
                 <div id="secaoItens" style="display: none; margin-bottom: 15px;">
                     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                         <label style="font-weight: 500; color: #374151; font-size: 14px;">Procedimentos e Produtos</label>
                         <button type="button" onclick="adicionarItem()" style="padding: 5px 10px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                             <i class="fas fa-plus"></i> Adicionar
                         </button>
                     </div>
                     <div id="listaItens" style="border: 1px solid #e5e7eb; border-radius: 6px; padding: 10px; background: #f9fafb;">
                         <!-- Itens serão adicionados aqui dinamicamente -->
                     </div>
                 </div>

                <!-- Data e Horário -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 5px; font-size: 14px;">Data *</label>
                        <input type="date" id="dataAgendamento" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 5px; font-size: 14px;">Horário *</label>
                        <input type="time" id="horarioAgendamento" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                    </div>
                </div>

                <!-- Valor Total (calculado automaticamente) -->
                 <div id="resumoValores" style="display: none; margin-bottom: 15px; padding: 12px; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px;">
                     <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                         <span style="font-weight: 500; color: #374151;">Subtotal:</span>
                         <span id="subtotalAgendamento" style="color: #374151;">R$ 0,00</span>
                     </div>
                     <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                         <span style="font-weight: 500; color: #374151;">Desconto Total:</span>
                         <span id="descontoTotalAgendamento" style="color: #ef4444;">R$ 0,00</span>
                     </div>
                     <div style="display: flex; justify-content: space-between; border-top: 1px solid #bae6fd; padding-top: 5px;">
                         <span style="font-weight: 600; color: #1e293b;">Total:</span>
                         <span id="totalAgendamento" style="font-weight: 600; color: #1e293b;">R$ 0,00</span>
                     </div>
                 </div>

                <!-- Observações -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 5px; font-size: 14px;">Observações</label>
                    <textarea id="observacoesAgendamento" rows="3" placeholder="Observações sobre o agendamento..." style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>
                </div>
            </div>

        </div>
        <div style="padding: 20px; border-top: 1px solid #e2e8f0; display: flex; gap: 10px; justify-content: flex-end; background: white;">
            <button type="button" onclick="fecharModal()" style="padding: 10px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; cursor: pointer;">Cancelar</button>
            <button type="submit" style="padding: 10px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                <i class="fas fa-save"></i> Salvar
            </button>
        </div>
        </form>
    </div>
</div>

<script src="/js/menuMobile.js"></script>
<script src="/js/agenda/agenda.js"></script>

<!-- Modal de Detalhes -->
<div id="modalDetalhes" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10001; justify-content: center; align-items: center;">
    <div style="background: white; border-radius: 8px; width: 90%; max-width: 600px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
        <div style="padding: 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; background: white;">
            <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #1e293b;">📋 Detalhes do Agendamento</h3>
            <button onclick="fecharModalDetalhes()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">&times;</button>
        </div>
        <div style="flex: 1; overflow-y: auto; padding: 20px;">
            <div id="conteudoDetalhes"></div>
        </div>
        <div style="padding: 20px; border-top: 1px solid #e2e8f0; display: flex; justify-content: flex-end; background: white;">
            <button onclick="fecharModalDetalhes()" style="padding: 10px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; cursor: pointer;">Fechar</button>
        </div>
    </div>
</div>

<!-- Modal de Reagendar -->
<div id="modalReagendar" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10001; justify-content: center; align-items: center;">
    <div style="background: white; border-radius: 8px; width: 90%; max-width: 500px; overflow: hidden;">
        <div style="padding: 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #1e293b;">📅 Reagendar Atendimento</h3>
            <button onclick="fecharModalReagendar()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">&times;</button>
        </div>
        <form id="formReagendar" onsubmit="confirmarReagendamento(event)">
            <div style="padding: 20px;">
                <div id="infoReagendamento" style="margin-bottom: 20px; padding: 12px; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px;"></div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 5px; font-size: 14px;">Nova Data *</label>
                    <input type="date" id="novaDataReagendar" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 5px; font-size: 14px;">Nova Hora *</label>
                    <input type="time" id="novaHoraReagendar" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                </div>
            </div>
            <div style="padding: 20px; border-top: 1px solid #e2e8f0; display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="fecharModalReagendar()" style="padding: 10px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; cursor: pointer;">Cancelar</button>
                <button type="submit" style="padding: 10px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">Reagendar</button>
            </div>
        </form>
    </div>
</div>